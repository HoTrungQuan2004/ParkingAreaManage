<!DOCTYPE html>
<html>
<head>
    <title>Smart Parking Management System</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Style.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🚗 Smart Parking Management System</h1>
            <div class="last-updated" id="lastUpdated">Last Updated: --</div>
            <button onclick="refreshData()" style="margin-top: 10px; padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">🔄 Refresh Data</button>
        </header>

        <!-- Parking Statistics Dashboard -->
        <div class="dashboard">
            <div class="stat-card total">
                <h3>Total Slots</h3>
                <div class="stat-number" id="totalSlots">--</div>
            </div>
            <div class="stat-card occupied">
                <h3>Occupied</h3>
                <div class="stat-number" id="occupiedSlots">--</div>
            </div>
            <div class="stat-card available">
                <h3>Available</h3>
                <div class="stat-number" id="availableSlots">--</div>
            </div>
            <div class="stat-card occupancy">
                <h3>Occupancy Rate</h3>
                <div class="stat-number" id="occupancyRate">--%</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <h3>📊 Daily Vehicle Count (Last 7 Days)</h3>
                <canvas id="dailyChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>📈 Monthly Vehicle Count (Last 6 Months)</h3>
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- Current Vehicles Section -->
        <div class="vehicles-section">
            <h2>🚙 Currently Parked Vehicles</h2>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="🔍 Search by license plate..." />
            </div>
            <div id="currentVehiclesList" class="vehicles-list"></div>
        </div>

        <!-- Recent Activity Section -->
        <div class="activity-section">
            <h2>📋 Recent Activity</h2>
            <div class="activity-tabs">
                <button class="tab-button active" onclick="showTab('entries')">Recent Entries</button>
                <button class="tab-button" onclick="showTab('exits')">Recent Exits</button>
            </div>
            <div id="recentEntriesList" class="activity-list"></div>
            <div id="recentExitsList" class="activity-list" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Debug function to check Firebase configuration
        function debugFirebaseConfig() {
            console.log('=== Firebase Debug Information ===');
            console.log('Firebase Config:', {
                apiKey: firebaseConfig.apiKey ? '***' + firebaseConfig.apiKey.slice(-4) : 'MISSING',
                authDomain: firebaseConfig.authDomain,
                databaseURL: firebaseConfig.databaseURL,
                projectId: firebaseConfig.projectId
            });
            
            // Check if Firebase scripts loaded
            console.log('Firebase app available:', typeof firebase !== 'undefined');
            console.log('Firebase database available:', typeof firebase?.database === 'function');
            
            // Check network connectivity
            if (navigator.onLine) {
                console.log('Network: Online');
            } else {
                console.log('Network: Offline');
            }
        }

        // Replace with your actual Firebase project configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCtQFHllFrIKIWhZiflNkV-4fVxl6yg5m0",
            authDomain: "liencesplayeai.firebaseapp.com",
            databaseURL: "https://liencesplayeai-default-rtdb.firebaseio.com",
            projectId: "liencesplayeai",
            storageBucket: "liencesplayeai.firebasestorage.app",
            messagingSenderId: "516014751151",
            appId: "1:516014751151:web:68baec2887916762eb035a",
            measurementId: "G-Z3M750GZQZ"
        };

        // Global variables
        let currentVehicles = {};
        let recentEntries = [];
        let recentExits = [];
        let dailyChart, monthlyChart;
        let db; // Firebase database reference

        // Initialize Firebase when DOM is ready
        function initializeFirebase() {
            try {
                debugFirebaseConfig();
                
                // Check if Firebase is loaded
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK not loaded. Check your internet connection.');
                }
                
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                console.log('Firebase initialized successfully');
                
                // Test database connection
                db.ref('.info/connected').on('value', function(snapshot) {
                    if (snapshot.val() === true) {
                        console.log('Connected to Firebase Realtime Database');
                        // Update connection status in UI
                        const lastUpdatedEl = document.querySelector('#lastUpdated');
                        if (lastUpdatedEl) {
                            lastUpdatedEl.style.color = '#4caf50';
                        }
                    } else {
                        console.log('Disconnected from Firebase Realtime Database');
                        const lastUpdatedEl = document.querySelector('#lastUpdated');
                        if (lastUpdatedEl) {
                            lastUpdatedEl.style.color = '#f44336';
                        }
                    }
                }, function(error) {
                    console.error('Connection monitoring error:', error);
                });
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                console.error('Error details:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
                
                // More specific error messages
                let errorMessage = 'Failed to connect to Firebase. ';
                if (error.message.includes('not loaded')) {
                    errorMessage += 'Firebase SDK failed to load. Check your internet connection.';
                } else if (error.code === 'app/invalid-api-key') {
                    errorMessage += 'Invalid API key in configuration.';
                } else if (error.code === 'app/invalid-app-argument') {
                    errorMessage += 'Invalid Firebase configuration.';
                } else {
                    errorMessage += 'Please check your configuration and internet connection.';
                }
                
                alert(errorMessage);
                
                // Update UI to show error
                const lastUpdatedEl = document.querySelector('#lastUpdated');
                if (lastUpdatedEl) {
                    lastUpdatedEl.textContent = 'Firebase connection failed';
                    lastUpdatedEl.style.color = '#f44336';
                }
            }
        }

        // DOM elements
        const totalSlotsEl = document.getElementById('totalSlots');
        const occupiedSlotsEl = document.getElementById('occupiedSlots');
        const availableSlotsEl = document.getElementById('availableSlots');
        const occupancyRateEl = document.getElementById('occupancyRate');
        const lastUpdatedEl = document.getElementById('lastUpdated');
        const currentVehiclesListEl = document.getElementById('currentVehiclesList');
        const recentEntriesListEl = document.getElementById('recentEntriesList');
        const recentExitsListEl = document.getElementById('recentExitsList');
        const searchInputEl = document.getElementById('searchInput');

        // Initialize charts
        function initCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            };

            dailyChart = new Chart(document.getElementById('dailyChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: '#2196f3',
                        borderColor: '#1976d2',
                        borderWidth: 1
                    }]
                },
                options: chartOptions
            });

            monthlyChart = new Chart(document.getElementById('monthlyChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderColor: '#2196f3',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: chartOptions
            });
        }

        // Update parking statistics
        function updateParkingStats(stats) {
            if (stats) {
                totalSlotsEl.textContent = stats.total_slots || 0;
                occupiedSlotsEl.textContent = stats.occupied_slots || 0;
                availableSlotsEl.textContent = stats.available_slots || 0;
                
                const occupancyPercentage = stats.total_slots > 0 
                    ? Math.round((stats.occupied_slots / stats.total_slots) * 100) 
                    : 0;
                occupancyRateEl.textContent = occupancyPercentage + '%';
                
                // Update occupancy rate color based on percentage
                const occupancyCard = document.querySelector('.stat-card.occupancy');
                occupancyCard.className = 'stat-card occupancy';
                if (occupancyPercentage >= 90) {
                    occupancyCard.classList.add('critical');
                } else if (occupancyPercentage >= 70) {
                    occupancyCard.classList.add('warning');
                }
                
                if (stats.last_updated) {
                    lastUpdatedEl.textContent = `Last Updated: ${formatDateTime(stats.last_updated)}`;
                }
            }
        }

        // Format date and time
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString();
        }

        // Format date only
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        // Add current vehicle to list
        function addCurrentVehicle(key, data) {
            currentVehicles[key] = data;
            displayCurrentVehicles();
        }

        // Remove current vehicle from list
        function removeCurrentVehicle(key) {
            if (currentVehicles[key]) {
                // Add to recent exits
                const exitData = {
                    ...currentVehicles[key],
                    exit_time: new Date().toISOString().replace('T', ' ').substr(0, 19)
                };
                recentExits.unshift(exitData);
                if (recentExits.length > 50) recentExits.pop();
                
                delete currentVehicles[key];
                displayCurrentVehicles();
                displayRecentExits();
            }
        }

        // Display current vehicles
        function displayCurrentVehicles() {
            if (!searchInputEl || !currentVehiclesListEl) {
                console.log('DOM elements not ready for displayCurrentVehicles');
                return;
            }

            const searchTerm = searchInputEl.value ? searchInputEl.value.toLowerCase() : '';
            const filteredVehicles = Object.entries(currentVehicles).filter(([key, data]) =>
                data.number_plate && data.number_plate.toLowerCase().includes(searchTerm)
            );

            currentVehiclesListEl.innerHTML = '';
            
            if (filteredVehicles.length === 0) {
                currentVehiclesListEl.innerHTML = '<div class="empty-state">No vehicles found</div>';
                return;
            }

            filteredVehicles.forEach(([key, data]) => {
                const vehicleEl = document.createElement('div');
                vehicleEl.className = 'plate current-vehicle';
                
                const entryTime = new Date(data.entry_time);
                const now = new Date();
                const duration = Math.floor((now - entryTime) / (1000 * 60)); // minutes
                
                let durationText = '';
                if (duration < 60) {
                    durationText = `${duration} min`;
                } else if (duration < 1440) {
                    durationText = `${Math.floor(duration / 60)}h ${duration % 60}m`;
                } else {
                    durationText = `${Math.floor(duration / 1440)}d ${Math.floor((duration % 1440) / 60)}h`;
                }
                
                vehicleEl.innerHTML = `
                    <div class="vehicle-info">
                        <div class="plate-number">🚗 ${data.number_plate}</div>
                        <div class="vehicle-details">
                            <span class="entry-time">📅 Entered: ${formatDateTime(data.entry_time)}</span>
                            <span class="duration">⏱️ Duration: ${durationText}</span>
                        </div>
                    </div>
                    ${data.image ? `<div class="vehicle-image"><img src="data:image/jpeg;base64,${data.image}" alt="Vehicle Image" onclick="showImageModal(this.src)"></div>` : ''}
                `;
                
                currentVehiclesListEl.appendChild(vehicleEl);
            });
        }

        // Display recent entries
        function displayRecentEntries() {
            if (!recentEntriesListEl) {
                console.log('recentEntriesListEl not ready');
                return;
            }

            recentEntriesListEl.innerHTML = '';
            
            if (recentEntries.length === 0) {
                recentEntriesListEl.innerHTML = '<div class="empty-state">No recent entries</div>';
                return;
            }

            recentEntries.slice(0, 20).forEach(data => {
                if (data && data.number_plate && data.entry_time) {
                    const entryEl = document.createElement('div');
                    entryEl.className = 'plate activity-entry';
                    entryEl.innerHTML = `
                        <div class="activity-info">
                            <div class="plate-number">🟢 ${data.number_plate}</div>
                            <div class="activity-time">📅 ${formatDateTime(data.entry_time)}</div>
                            <div class="activity-status">Status: Vehicle Entered</div>
                        </div>
                    `;
                    recentEntriesListEl.appendChild(entryEl);
                }
            });
        }

        // Display recent exits
        function displayRecentExits() {
            if (!recentExitsListEl) {
                console.log('recentExitsListEl not ready');
                return;
            }

            recentExitsListEl.innerHTML = '';
            
            if (recentExits.length === 0) {
                recentExitsListEl.innerHTML = '<div class="empty-state">No recent exits</div>';
                return;
            }

            recentExits.slice(0, 20).forEach(data => {
                if (data && data.number_plate && data.exit_time) {
                    const exitEl = document.createElement('div');
                    exitEl.className = 'plate activity-exit';
                    exitEl.innerHTML = `
                        <div class="activity-info">
                            <div class="plate-number">🔴 ${data.number_plate}</div>
                            <div class="activity-time">📅 ${formatDateTime(data.exit_time)}</div>
                            <div class="activity-status">Status: Vehicle Exited</div>
                        </div>
                    `;
                    recentExitsListEl.appendChild(exitEl);
                }
            });
        }

        // Update daily chart
        function updateDailyChart(dailyData) {
            const last7Days = [];
            const counts = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }));
                
                // Check if data exists for this date
                const dayData = dailyData && dailyData[dateStr] ? dailyData[dateStr].count : 0;
                counts.push(dayData);
            }
            
            console.log('Updating daily chart with:', { labels: last7Days, data: counts });
            
            if (dailyChart) {
                dailyChart.data.labels = last7Days;
                dailyChart.data.datasets[0].data = counts;
                dailyChart.update();
            }
        }

        // Update monthly chart
        function updateMonthlyChart(monthlyData) {
            const last6Months = [];
            const counts = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthStr = date.toISOString().substr(0, 7);
                last6Months.push(date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }));
                
                // Check if data exists for this month
                const monthData = monthlyData && monthlyData[monthStr] ? monthlyData[monthStr].count : 0;
                counts.push(monthData);
            }
            
            console.log('Updating monthly chart with:', { labels: last6Months, data: counts });
            
            if (monthlyChart) {
                monthlyChart.data.labels = last6Months;
                monthlyChart.data.datasets[0].data = counts;
                monthlyChart.update();
            }
        }

        // Show tab
        function showTab(tab) {
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('recentEntriesList').style.display = 'none';
            document.getElementById('recentExitsList').style.display = 'none';
            
            if (tab === 'entries') {
                document.getElementById('recentEntriesList').style.display = 'block';
                buttons[0].classList.add('active');
            } else {
                document.getElementById('recentExitsList').style.display = 'block';
                buttons[1].classList.add('active');
            }
        }

        // Show image modal
        function showImageModal(src) {
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <img src="${src}" alt="Vehicle Image">
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Manual refresh function for testing
        function refreshData() {
            console.log('Manually refreshing data...');
            if (db) {
                // Manually trigger data refresh
                db.ref('parking_stats').once('value').then(snapshot => {
                    updateParkingStats(snapshot.val());
                });
                
                db.ref('daily_counts').once('value').then(snapshot => {
                    updateDailyChart(snapshot.val() || {});
                });
                
                db.ref('monthly_counts').once('value').then(snapshot => {
                    updateMonthlyChart(snapshot.val() || {});
                });
                
                db.ref('vehicles').once('value').then(snapshot => {
                    const vehicles = snapshot.val();
                    if (vehicles) {
                        currentVehicles = vehicles;
                        displayCurrentVehicles();
                    }
                });
            }
        }

        // Initialize the application
        function init() {
            console.log('Initializing application...');
            
            // Initialize Firebase first
            initializeFirebase();
            
            // Initialize charts
            initCharts();
            
            // Setup search functionality after DOM is ready
            if (searchInputEl) {
                searchInputEl.addEventListener('input', displayCurrentVehicles);
                console.log('Search functionality initialized');
            }
            
            // Test Firebase connection after a short delay
            setTimeout(() => {
                testFirebaseConnection();
                setupFirebaseListeners();
            }, 1000);
            
            // Initialize sample data after Firebase is ready
            setTimeout(() => {
                initializeSampleData();
            }, 3000);
            
            // Update timestamp every minute
            setInterval(() => {
                const now = new Date();
                const lastUpdatedEl = document.getElementById('lastUpdated');
                if (lastUpdatedEl && !lastUpdatedEl.textContent.includes('Firebase connection failed')) {
                    if (!lastUpdatedEl.textContent.includes('Connected to Firebase')) {
                        lastUpdatedEl.textContent = `Last Updated: ${now.toLocaleString()}`;
                    }
                }
            }, 60000);
        }

        // Firebase listeners
        function setupFirebaseListeners() {
            if (!db) {
                console.error('Database not initialized');
                return;
            }

            try {
                // Listen for parking statistics
                db.ref('parking_stats').on('value', snapshot => {
                    console.log('Parking stats received:', snapshot.val());
                    updateParkingStats(snapshot.val());
                }, error => {
                    console.error('Error reading parking stats:', error);
                });

                // Listen for current vehicles
                db.ref('vehicles').on('child_added', snapshot => {
                    console.log('Vehicle added:', snapshot.key, snapshot.val());
                    const data = snapshot.val();
                    addCurrentVehicle(snapshot.key, data);
                    recentEntries.unshift(data);
                    if (recentEntries.length > 50) recentEntries.pop();
                    displayRecentEntries();
                }, error => {
                    console.error('Error reading vehicles:', error);
                });

                db.ref('vehicles').on('child_removed', snapshot => {
                    console.log('Vehicle removed:', snapshot.key);
                    removeCurrentVehicle(snapshot.key);
                }, error => {
                    console.error('Error on vehicle removal:', error);
                });

                // Listen for daily counts
                db.ref('daily_counts').on('value', snapshot => {
                    console.log('Daily counts received:', snapshot.val());
                    updateDailyChart(snapshot.val() || {});
                }, error => {
                    console.error('Error reading daily counts:', error);
                });

                // Listen for monthly counts
                db.ref('monthly_counts').on('value', snapshot => {
                    console.log('Monthly counts received:', snapshot.val());
                    updateMonthlyChart(snapshot.val() || {});
                }, error => {
                    console.error('Error reading monthly counts:', error);
                });

                console.log('Firebase listeners set up successfully');
            } catch (error) {
                console.error('Error setting up Firebase listeners:', error);
            }
        }

        // Test Firebase connection
        function testFirebaseConnection() {
            if (!db) {
                console.error('Database not initialized for testing');
                return;
            }

            console.log('Testing Firebase connection...');
            
            // Test read access to a simple path
            db.ref('.info/serverTimeOffset').once('value')
                .then(snapshot => {
                    console.log('Firebase read test successful, server time offset:', snapshot.val());
                    console.log('Testing database rules...');
                    
                    // Try to read the root to test permissions
                    return db.ref('/').limitToFirst(1).once('value');
                })
                .then(snapshot => {
                    console.log('Database rules test successful');
                    
                    // Update UI to show connection is working
                    const lastUpdatedEl = document.getElementById('lastUpdated');
                    if (lastUpdatedEl) {
                        lastUpdatedEl.textContent = 'Connected to Firebase - ' + new Date().toLocaleString();
                        lastUpdatedEl.style.color = '#4caf50';
                    }
                })
                .catch(error => {
                    console.error('Firebase connection test failed:', error);
                    
                    let errorMsg = 'Firebase connection failed: ';
                    if (error.code === 'PERMISSION_DENIED') {
                        errorMsg += 'Database rules deny access. Please check your Firebase security rules.';
                        console.error('SOLUTION: Go to Firebase Console > Realtime Database > Rules and set:');
                        console.error('{"rules": {".read": true, ".write": true}}');
                    } else if (error.code === 'NETWORK_ERROR') {
                        errorMsg += 'Network error. Check your internet connection.';
                    } else {
                        errorMsg += error.message;
                    }
                    
                    const lastUpdatedEl = document.getElementById('lastUpdated');
                    if (lastUpdatedEl) {
                        lastUpdatedEl.textContent = errorMsg;
                        lastUpdatedEl.style.color = '#f44336';
                    }
                });
        }

        // Initialize sample data for testing (if no real data exists)
        function initializeSampleData() {
            if (!db) return;
            
            console.log('Checking and initializing sample data...');
            
            // Initialize parking stats
            db.ref('parking_stats').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    console.log('No parking stats found, initializing sample data...');
                    db.ref('parking_stats').set({
                        total_slots: 100,
                        occupied_slots: 15,
                        available_slots: 85,
                        last_updated: new Date().toISOString()
                    });
                }
            }).catch(error => {
                console.error('Error checking parking stats:', error);
            });

            // Initialize sample vehicles
            db.ref('vehicles').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    console.log('No vehicles found, initializing sample vehicles...');
                    
                    const sampleVehicles = {
                        'vehicle_1': {
                            number_plate: 'ABC-123',
                            entry_time: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
                        },
                        'vehicle_2': {
                            number_plate: 'XYZ-789',
                            entry_time: new Date(Date.now() - 45 * 60 * 1000).toISOString(), // 45 minutes ago
                        },
                        'vehicle_3': {
                            number_plate: 'DEF-456',
                            entry_time: new Date(Date.now() - 30 * 60 * 1000).toISOString(), // 30 minutes ago
                        }
                    };
                    
                    db.ref('vehicles').set(sampleVehicles);
                }
            }).catch(error => {
                console.error('Error checking vehicles:', error);
            });

            // Initialize daily counts for the last 7 days
            db.ref('daily_counts').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    console.log('No daily counts found, initializing sample daily data...');
                    
                    const dailyCounts = {};
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        const dateStr = date.toISOString().split('T')[0];
                        dailyCounts[dateStr] = {
                            count: Math.floor(Math.random() * 50) + 10, // Random count between 10-60
                            date: dateStr
                        };
                    }
                    
                    db.ref('daily_counts').set(dailyCounts);
                }
            }).catch(error => {
                console.error('Error checking daily counts:', error);
            });

            // Initialize monthly counts for the last 6 months
            db.ref('monthly_counts').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    console.log('No monthly counts found, initializing sample monthly data...');
                    
                    const monthlyCounts = {};
                    for (let i = 5; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        const monthStr = date.toISOString().substr(0, 7); // YYYY-MM format
                        monthlyCounts[monthStr] = {
                            count: Math.floor(Math.random() * 800) + 200, // Random count between 200-1000
                            month: monthStr
                        };
                    }
                    
                    db.ref('monthly_counts').set(monthlyCounts);
                }
            }).catch(error => {
                console.error('Error checking monthly counts:', error);
            });
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
